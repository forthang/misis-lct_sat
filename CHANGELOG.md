# Changelog - Улучшения проекта

## Обзор изменений

### 1. Backend (API)

#### Новые агенты для анализа (`api/core/agent/agents.py`)
- **Агент выявления проблем** - анализирует негативные отзывы и группирует проблемы по категориям
- **Агент генерации рекомендаций** - создает конкретные рекомендации на основе выявленных проблем
- **Агент создания резюме** - формирует краткое резюме для руководства
- **Детектор алертов** - выявляет критические ситуации и аномалии

#### Новые эндпоинты (`api/routes/ai.py`)
- `POST /api/ai/recommendations` - генерация рекомендаций (существовал)
- `POST /api/ai/full-analysis` - полный анализ: проблемы + рекомендации + резюме
- `POST /api/ai/detect-alerts` - выявление критических ситуаций

#### Улучшенная генерация отчетов (`api/routes/reports.py`)
- Красивое форматирование Excel с цветными заголовками
- Структурированный PDF с таблицами
- Поддержка выбора тем для отчета
- Несколько листов в Excel (статистика, темы, тренды)

#### Улучшения в `api/app.py`
- Добавлен `/health` эндпоинт для проверки работоспособности
- Корректная настройка CORS для локальной разработки
- Добавлен корневой эндпоинт с информацией об API

#### Новые функции в `api/core/db/review_crud.py`
- `get_topics_negative_stats()` - статистика негативных отзывов для алертов
- Исправлены проблемы с форматированием кода

### 2. Frontend

#### Улучшенная тепловая карта
- Заменена ScatterChart на CSS Grid для лучшей визуализации
- Добавлена легенда с градиентом
- Интерактивные ячейки с hover-эффектами
- Блок "Топ проблемных тем" с прогресс-барами

#### Улучшенные оповещения
- Skeleton loading при загрузке
- Цветовая индикация по уровню критичности (danger/warning/info)
- Анимации и hover-эффекты
- Пустое состояние с информативным сообщением

#### Исправления
- URL для экспорта CSV исправлен на `http://localhost:8000/api/export/reviews`
- Конвертация line endings в Unix формат

### 3. Стили (`frontend/src/App.css`)
Добавлены новые стили:
- `.heatmap-*` - стили для тепловой карты
- `.alert-card--*` - стили для карточек оповещений
- `.skeleton` - анимация загрузки
- `.heatmap-stat-item` - статистика проблемных тем
- `.summary-card` - карточка резюме
- `.problems-list` - список проблем

## Как использовать

### Запуск проекта
```bash
docker compose up
```

### Доступ к сервисам
- Frontend: http://localhost:5173
- API: http://localhost:8000
- API Docs: http://localhost:8000/docs
- Health Check: http://localhost:8000/health

### Новые возможности

#### Полный анализ отзывов
```bash
curl -X POST http://localhost:8000/api/ai/full-analysis \
  -H "Content-Type: application/json" \
  -d '{
    "start_date": "2024-01-01T00:00:00Z",
    "end_date": "2024-12-31T23:59:59Z",
    "mode": "all:month",
    "topics": ["creditcards"]
  }'
```

#### Генерация отчета
```bash
curl -X POST http://localhost:8000/api/reports/generate \
  -H "Content-Type: application/json" \
  -d '{
    "start_date": "2024-01-01T00:00:00Z",
    "end_date": "2024-12-31T23:59:59Z",
    "mode": "all:month",
    "topics": ["creditcards", "hypothec"],
    "format": "excel"
  }' --output report.xlsx
```

## Архитектура агентов

```
┌─────────────────────────────────────────────────────────────┐
│                    Analysis Agent                            │
├─────────────────────────────────────────────────────────────┤
│  START                                                       │
│    │                                                         │
│    ▼                                                         │
│  ┌─────────────────┐                                        │
│  │ detect_problems │ ← Анализ отзывов, группировка проблем  │
│  └────────┬────────┘                                        │
│           │                                                  │
│           ▼                                                  │
│  ┌─────────────────────────┐                                │
│  │ generate_recommendations│ ← Создание рекомендаций        │
│  └────────┬────────────────┘                                │
│           │                                                  │
│           ▼                                                  │
│  ┌──────────────────┐                                       │
│  │ generate_summary │ ← Краткое резюме для руководства      │
│  └────────┬─────────┘                                       │
│           │                                                  │
│           ▼                                                  │
│         END                                                  │
└─────────────────────────────────────────────────────────────┘
```

## TODO (возможные дальнейшие улучшения)

- [ ] Добавить кэширование результатов анализа (Redis)
- [ ] Реализовать автоматическую выгрузку новых отзывов по расписанию
- [ ] Добавить email-уведомления при критических алертах
- [ ] Расширить метрики качества (Precision, Recall)
- [ ] Добавить A/B тестирование рекомендаций
